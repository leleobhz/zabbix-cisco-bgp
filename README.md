ZBX-CISCO-BGP4
==============

This template use the BGP4-MIB to discover and manage both IPv4 and VPNv4 neighbors on Cisco devices. 

This version is entirelly based on work at https://github.com/jjmartres/Zabbix/tree/master/zbx-templates/zbx-cisco/zbx-cisco-bgp4 with the following changes:

  * Changed Team CYMRU whois query to ipinfo.io based query.
  * Changed as.name to work as a shell script, compatible with busybox and with https://hub.docker.com/r/zabbix/zabbix-server-pgsql/
  * Exported directly from Zabbix 4.2.5

Items
-----

  * Discovery: administrative status of a peer
  * Discovery: operational status of a peer
  * Discovery: established time for a peer
  * Discovery: remote AS for a peer
  * Discovery: accepted prefixes for IPv4 and/or VPNv4 peers
  * Discovery: advertised prefixes for IPv4 and/or VPNv4 peers
  * Discovery: denied prefixes for IPv4 and/or VPNv4 peers
  * Discovery: prefixes limit for IPv4 and/or VPNv4 peers
  * Discovery: suppressed prefixes for IPv4 and/or VPNv4 peers

Triggers
--------

  * **[DISASTER]** => Discovery: BGP peer that remote AS match {$BGP_PEER_AS} macro is down
  * **[AVERAGE]** => Discovery: BGP peer that remote AS didn't match {$BGP_PEER_AS} macro is down
  * **[AVERAGE]** => Discovery: accepted prefixes for IPv4 as reached the maximum limit
  * **[AVERAGE]** => Discovery: accepted prefixes for VPNv4 as reached the maximum limit
  * **[AVERAGE]** => Discovery: IPv4 BGP peer has lost more than 20% of prefixes
  * **[AVERAGE]** => Discovery: VPNv4 BGP peer has lost more than 20% of prefixes
  * **[INFORMATION]** => Discovery: no prefixes receive for IPv4 peer
  * **[INFORMATION]** => Discovery: no prefixes receive for VPNv4 peer

Graphs
------

  * Discovery: BGP informations for IPv4 peer
  * Discovery: BGP informations for VPNv4 peer

Installation
------------

1. Add a value mapping named `ciscoBgpPeerAdminStatus` with the following values:
  * 1 => stop
  * 2 => start
2. Add a value mapping named `ciscoBgpPeerState` with the following values:
  * 1 => idle
  * 2 => connect
  * 3 => active
  * 4 => opensent
  * 5 => openconfirm
  * 6 => established
3. Install [`as.name`](https://github.com/jjmartres/Zabbix/tree/master/zbx-scripts/as.name) in the **ExternalScripts** directory of your Zabbix server and/or proxy. Check your `zabbix_server.conf` and/or `zabbix_proxy.conf` if in doubt.
4. Then `chmod a+x as.name`
5. Import **zbx-cisco-bgp4.xml** file into Zabbix.
6. Add to your host the **{$SNMP_COMMUNITY}** macro with your SNMP community as value.
7. Add to your host the **{$BGP_PEER_AS}** macro with your list BGP peer remote AS as value (ex: ASN1|ASN2|ASN3)
8. Associate **ZBX-CISCO-BGP4** template to the host.

### Requirements

This template was tested for Zabbix 2.0.0 and higher. There are no additional requirements.

Version changed by Leonardo Amaral works with busybox wget and bash. Wget options used are compatible with GNU wget. This changes are supported in Zabbix 4.2.5 and expected to work on any Zabbix version.

License
-------

This template is distributed under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the  License, or (at your option) any later version.

### Copyright

  Copyright (c) Jean-Jacques Martrès

### Authors

  Jean-Jacques Martrès
  (jjmartres |at| gmail |dot| com)

### Changes made by

  Leonardo Amaral
  (github ;at; leonardoamaral ;dot; com ;dot; br)
